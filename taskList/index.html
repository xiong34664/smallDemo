<!DOCTYPE html>
<html lang="en" manifest="note.appcache">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>记事本</title>
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
<div class="start">
    <div class="logo">
        notepad
    </div>
    <div class="loading">
        <i></i>
        <i></i>
        <i></i>
    </div>
</div>
<nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
        <div class="navbar-collapse">
            <div class="row">
                <div class="col-md-3 col-xs-3 ">
                    <button class="btn btn-default navbar-btn btn-empty">清空</button>
                </div>
                <div class="col-md-offset-1 col-md-4 col-xs-offset-1 col-xs-4"><a class="navbar-brand" href="JavaScript:;"></a></div>
                <div class="col-md-offset-1 col-md-3 col-xs-offset-1 col-xs-3 text-right">
                    <button class="btn btn-success navbar-btn btn-add">添加</button>
                </div>
            </div>
        </div>

    </div>
</nav>

<div class="modal fade" id="Modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="exampleModalLabel">新建任务</h4>
            </div>
            <div class="modal-body">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary btn-ok" data-dismiss="modal">确定</button>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">

    </div>
</div>

<script type="text/template" id="note-list">
    {{ each items }}
    <div class="panel panel-default {{$value[1]==1?'panel-info':''}}" data-id="{{$value[0]}}">
        <div class="panel-heading" role="tab" id="headingThree">
            <h4 class="panel-title checkbox">
                <label>
                    <input type="checkbox" class="checkbox" {{$value[1]==1?"checked":""}} >
                </label>
                <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseThree{{$value[0]}}" aria-expanded="false" aria-controls="collapseThree">
                    {{$value[2]}}
                </a>
                <button type="button" class="close"><span>&times;</span></button>
            </h4>

        </div>
        <div id="collapseThree{{$value[0]}}" class="panel-collapse collapse {{$index==0?'in':''}}" role="tabpanel" aria-labelledby="headingThree" aria-expanded="false">
            <div class="panel-body">
                {{$value[3]}}
            </div>
        </div>
    </div>
    {{ /each }}
</script>

<script src="js/jquery-1.12.2.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/template-web.js"></script>
<script>

    $(window).load(function() {
        setTimeout(function(){
            $(".start").fadeOut(500);
        },1000);
    });

    $(function () {
        var arr = [];
        $.each(localStorage,function (index,ele) {
            if(index.indexOf("note")===0){
                var id = index.split("-")[1];
                var array = ele.split("|");
                array.unshift(id);
                arr.push(array);
            }
        });
        if(!arr.length){
            arr[0]=["1","0","←选中时即为完成任务/任务标题","这是你的任务内容点击标题展开收起"];
            localStorage.setItem("note-"+1,"0|←选中时即为完成任务/任务标题|这是你的任务内容点击标题展开收起");
            console.log(arr);
        }
        var html = template("note-list", {"items": arr});
        $("#accordion").html(html);

        //添加新任务
        $(".btn-add").on("click",function () {
            var body = '<form>\n' +
                '          <div class="form-group">\n' +
                '             <label for="title" class="control-label">标题:</label>\n' +
                '             <input type="text" class="form-control" id="title">\n' +
                '          </div>\n' +
                '          <div class="form-group">\n' +
                '             <label for="content" class="control-label">内容:</label>\n' +
                '             <textarea class="form-control" id="content"></textarea>\n' +
                '          </div>\n' +
                '        </form>';
            diyModal("新建任务",body,true);
            $("#Modal").modal("show");
            $(".btn-ok").off("click");
            //点击确认添加
            $(".btn-ok").on("click",function () {
                var id = 0;
                if(arr.length !== 0) {
                    id = (arr[arr.length-1][0]-0)+1;
                }
                var titlt = $("#title").val();
                var content = $("#content").val();
                localStorage.setItem("note-"+id,"0|"+titlt+"|"+content);
                $("#title").val("");
                $("#content").val("");
                var array = [[id,0,titlt,content]];
                arr.push([id,0,titlt,content]);
                var html = template("note-list", {"items": array});
                $("#accordion").append(html);
                setTimeout(function () {
                    diyModal("提示","添加成功",false);
                    $("#Modal").modal("show");
                },1000)
            });
        });


        //删除全部
        $(".btn-empty").on("click",function () {
            diyModal("提示","是否确认删除全部",true);
            $("#Modal").modal("show");
            $(".btn-ok").off("click");
            $(".btn-ok").on("click",function () {
                localStorage.clear();
                setTimeout(function () {
                    diyModal("提示","全部删除成功",false);
                    $("#Modal").modal("show");
                    $(".panel-group").html("");
                },1000)
            });
        });

        //删除
        $("#accordion").on("click",".close",function () {
            var parent = $(this).parents(".panel");
            localStorage.removeItem("note-"+parent.attr("data-id"));
            parent.remove();
            diyModal("提示","删除成功",false);
            $("#Modal").modal("show");
            return false;
        });
        //多选按钮改变时  触发
        $("#accordion").on("change",".checkbox",function () {
            var state = $(this).prop("checked")?1:0;
            var parent = $(this).parents(".panel");
            var current = "note-"+parent.attr("data-id");
            var arr = localStorage.getItem(current).split("|");
            arr[0] = state;
            localStorage.setItem(current,arr.join("|"));
            parent.toggleClass("panel-info");
            return false;
        });
    });

    //弹出框的内容和显示按钮的封装
    function diyModal(title,con,flag) {
        flag?$("#Modal").find(".modal-footer").show():$("#Modal").find(".modal-footer").hide();
        $("#Modal").find("h4").text(title).end().find(".modal-body").html(con);
    }
</script>
</body>
</html>